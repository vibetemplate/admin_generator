# å¼€å‘æœ€ä½³å®è·µ

æœ¬æ–‡æ¡£æ€»ç»“äº†ä½¿ç”¨åå°ç®¡ç†ç³»ç»Ÿç”Ÿæˆå™¨çš„æœ€ä½³å®è·µï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºé«˜è´¨é‡ã€å¯ç»´æŠ¤çš„ç®¡ç†åå°ç³»ç»Ÿã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### 1. ç›®å½•ç»“æ„

```
my-admin/
â”œâ”€â”€ app/                     # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/             # è®¤è¯è·¯ç”±ç»„
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ register/
â”‚   â”œâ”€â”€ (dashboard)/        # ä¸»è¦åŠŸèƒ½è·¯ç”±ç»„
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â””â”€â”€ products/
â”‚   â”œâ”€â”€ api/                # API è·¯ç”±
â”‚   â”œâ”€â”€ globals.css
â”‚   â””â”€â”€ layout.tsx
â”œâ”€â”€ components/             # ç»„ä»¶åº“
â”‚   â”œâ”€â”€ ui/                # åŸºç¡€UIç»„ä»¶
â”‚   â”œâ”€â”€ business/          # ä¸šåŠ¡ç»„ä»¶
â”‚   â””â”€â”€ layout/            # å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ lib/                   # å·¥å…·åº“
â”‚   â”œâ”€â”€ api.ts            # APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯å·¥å…·
â”‚   â”œâ”€â”€ utils.ts          # é€šç”¨å·¥å…·
â”‚   â””â”€â”€ validations.ts    # è¡¨å•éªŒè¯
â”œâ”€â”€ hooks/                # è‡ªå®šä¹‰Hooks
â”œâ”€â”€ store/                # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ types/                # TypeScriptç±»å‹å®šä¹‰
â”œâ”€â”€ constants/            # å¸¸é‡å®šä¹‰
â””â”€â”€ config/               # é…ç½®æ–‡ä»¶
```

### 2. æ¨¡å—åŒ–è®¾è®¡

```typescript
// types/user.ts
export interface User {
  id: string
  name: string
  email: string
  role: UserRole
}

// hooks/useUsers.ts
export const useUsers = () => {
  return useQuery({
    queryKey: ['users'],
    queryFn: fetchUsers
  })
}

// components/business/UserList.tsx
export const UserList = () => {
  const { data: users, loading } = useUsers()
  
  return (
    <DataTable
      columns={userColumns}
      data={users}
      loading={loading}
    />
  )
}
```

### 3. åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Presentation  â”‚ â† é¡µé¢ç»„ä»¶ (app/*)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Business      â”‚ â† ä¸šåŠ¡ç»„ä»¶ (components/business/*)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   UI            â”‚ â† UIç»„ä»¶ (components/ui/*)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Service       â”‚ â† APIæœåŠ¡ (lib/api.ts)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Data          â”‚ â† çŠ¶æ€ç®¡ç† (store/*)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ ç»„ä»¶è®¾è®¡

### 1. ç»„ä»¶å¤ç”¨åŸåˆ™

```typescript
// âŒ ä¸å¥½çš„åšæ³• - ç»„ä»¶è€¦åˆåº¦é«˜
const UserManagement = () => {
  return (
    <div>
      <div className="header">ç”¨æˆ·ç®¡ç†</div>
      <div className="search">
        <Input placeholder="æœç´¢ç”¨æˆ·" />
        <Button>æœç´¢</Button>
      </div>
      <Table columns={userColumns} data={users} />
    </div>
  )
}

// âœ… å¥½çš„åšæ³• - ç»„ä»¶å¯å¤ç”¨
const UserManagement = () => {
  return (
    <PageContainer title="ç”¨æˆ·ç®¡ç†">
      <SearchForm fields={userSearchFields} onSearch={handleSearch} />
      <DataTable columns={userColumns} data={users} actions={userActions} />
    </PageContainer>
  )
}
```

### 2. ç»„ä»¶å±æ€§è®¾è®¡

```typescript
// âœ… æ¸…æ™°çš„å±æ€§æ¥å£
interface DataTableProps<T = any> {
  columns: DataTableColumn<T>[]
  data: T[]
  loading?: boolean
  pagination?: PaginationConfig
  rowSelection?: RowSelectionConfig
  actions?: ActionConfig[]
  onRefresh?: () => void
  onCreate?: () => void
}

// âœ… é»˜è®¤å€¼å¤„ç†
const DataTable = <T,>({
  columns,
  data,
  loading = false,
  pagination = defaultPagination,
  actions = [],
  ...props
}: DataTableProps<T>) => {
  // ç»„ä»¶å®ç°
}
```

### 3. ç»„ä»¶ç»„åˆæ¨¡å¼

```typescript
// âœ… ä½¿ç”¨ç»„åˆæ¨¡å¼æé«˜çµæ´»æ€§
const UserPage = () => {
  return (
    <PageContainer title="ç”¨æˆ·ç®¡ç†">
      <SearchForm fields={searchFields} onSearch={handleSearch} />
      
      <Card>
        <DataTable.Toolbar>
          <DataTable.Actions>
            <Button type="primary" onClick={handleCreate}>
              æ–°å»ºç”¨æˆ·
            </Button>
          </DataTable.Actions>
          <DataTable.Filters>
            <Select placeholder="è§’è‰²ç­›é€‰" options={roleOptions} />
          </DataTable.Filters>
        </DataTable.Toolbar>
        
        <DataTable
          columns={columns}
          data={data}
          loading={loading}
        />
      </Card>
    </PageContainer>
  )
}
```

## ğŸ”„ çŠ¶æ€ç®¡ç†

### 1. æ•°æ®è·å–æ¨¡å¼

```typescript
// ä½¿ç”¨ React Query ç®¡ç†æœåŠ¡ç«¯çŠ¶æ€
export const useUsers = (params?: UserSearchParams) => {
  return useQuery({
    queryKey: ['users', params],
    queryFn: () => fetchUsers(params),
    staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿ
    cacheTime: 10 * 60 * 1000, // 10åˆ†é’Ÿ
  })
}

// ä½¿ç”¨ Zustand ç®¡ç†å®¢æˆ·ç«¯çŠ¶æ€
interface AppState {
  user: User | null
  theme: Theme
  sidebarCollapsed: boolean
}

export const useAppStore = create<AppState>((set) => ({
  user: null,
  theme: 'light',
  sidebarCollapsed: false,
  setUser: (user) => set({ user }),
  toggleSidebar: () => set((state) => ({ 
    sidebarCollapsed: !state.sidebarCollapsed 
  })),
}))
```

### 2. è¡¨å•çŠ¶æ€ç®¡ç†

```typescript
// ä½¿ç”¨ React Hook Form + Zod
const userSchema = z.object({
  name: z.string().min(2, 'å§“åè‡³å°‘2ä¸ªå­—ç¬¦'),
  email: z.string().email('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€'),
  role: z.enum(['admin', 'user'], {
    required_error: 'è¯·é€‰æ‹©è§’è‰²'
  })
})

type UserFormData = z.infer<typeof userSchema>

const UserForm = () => {
  const form = useForm<UserFormData>({
    resolver: zodResolver(userSchema),
    defaultValues: {
      name: '',
      email: '',
      role: 'user'
    }
  })

  const onSubmit = (data: UserFormData) => {
    // æäº¤å¤„ç†
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)}>
        {/* è¡¨å•å­—æ®µ */}
      </form>
    </Form>
  )
}
```

## ğŸ” æƒé™ç®¡ç†

### 1. æƒé™æ£€æŸ¥Hooks

```typescript
// hooks/usePermissions.ts
export const usePermissions = () => {
  const { user } = useAuth()
  
  const hasPermission = useCallback((permission: string) => {
    if (!user || !user.permissions) return false
    
    // è¶…çº§ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰æƒé™
    if (user.permissions.includes('*')) return true
    
    // æ£€æŸ¥å…·ä½“æƒé™
    return user.permissions.includes(permission)
  }, [user])
  
  const hasAnyPermission = useCallback((permissions: string[]) => {
    return permissions.some(permission => hasPermission(permission))
  }, [hasPermission])
  
  return { hasPermission, hasAnyPermission }
}
```

### 2. æƒé™ä¿æŠ¤ç»„ä»¶

```typescript
// components/auth/PermissionGuard.tsx
interface PermissionGuardProps {
  permission: string | string[]
  fallback?: React.ReactNode
  children: React.ReactNode
}

export const PermissionGuard: React.FC<PermissionGuardProps> = ({
  permission,
  fallback = null,
  children
}) => {
  const { hasPermission, hasAnyPermission } = usePermissions()
  
  const allowed = Array.isArray(permission)
    ? hasAnyPermission(permission)
    : hasPermission(permission)
  
  return allowed ? children : fallback
}

// ä½¿ç”¨ç¤ºä¾‹
<PermissionGuard permission="users:create">
  <Button type="primary" onClick={handleCreate}>
    æ–°å»ºç”¨æˆ·
  </Button>
</PermissionGuard>
```

### 3. è·¯ç”±æƒé™ä¿æŠ¤

```typescript
// middleware.ts
export function middleware(request: NextRequest) {
  const token = request.cookies.get('token')?.value
  
  if (!token) {
    return NextResponse.redirect(new URL('/login', request.url))
  }
  
  // éªŒè¯tokenå¹¶æ£€æŸ¥è·¯ç”±æƒé™
  const user = verifyToken(token)
  const pathname = request.nextUrl.pathname
  
  if (!hasRoutePermission(user, pathname)) {
    return NextResponse.redirect(new URL('/403', request.url))
  }
  
  return NextResponse.next()
}

export const config = {
  matcher: [
    '/((?!api|_next/static|_next/image|favicon.ico|login).*)',
  ],
}
```

## ğŸ“Š æ•°æ®å¤„ç†

### 1. APIå®¢æˆ·ç«¯å°è£…

```typescript
// lib/api.ts
class ApiClient {
  private baseURL: string
  private timeout: number

  constructor(config: ApiConfig) {
    this.baseURL = config.baseURL
    this.timeout = config.timeout
  }

  private async request<T>(
    url: string,
    options: RequestInit = {}
  ): Promise<ApiResponse<T>> {
    const controller = new AbortController()
    const timeoutId = setTimeout(() => controller.abort(), this.timeout)

    try {
      const response = await fetch(`${this.baseURL}${url}`, {
        ...options,
        signal: controller.signal,
        headers: {
          'Content-Type': 'application/json',
          ...this.getAuthHeaders(),
          ...options.headers,
        },
      })

      clearTimeout(timeoutId)

      if (!response.ok) {
        throw new ApiError(response.status, await response.text())
      }

      return await response.json()
    } catch (error) {
      clearTimeout(timeoutId)
      throw error
    }
  }

  async get<T>(url: string): Promise<ApiResponse<T>> {
    return this.request<T>(url, { method: 'GET' })
  }

  async post<T>(url: string, data?: any): Promise<ApiResponse<T>> {
    return this.request<T>(url, {
      method: 'POST',
      body: data ? JSON.stringify(data) : undefined,
    })
  }
}

export const apiClient = new ApiClient({
  baseURL: process.env.NEXT_PUBLIC_API_URL!,
  timeout: 10000,
})
```

### 2. é”™è¯¯å¤„ç†

```typescript
// lib/error-handler.ts
export class AppError extends Error {
  constructor(
    public code: string,
    public message: string,
    public statusCode?: number
  ) {
    super(message)
    this.name = 'AppError'
  }
}

export const errorHandler = (error: unknown) => {
  console.error('åº”ç”¨é”™è¯¯:', error)

  if (error instanceof AppError) {
    message.error(error.message)
  } else if (error instanceof ApiError) {
    switch (error.statusCode) {
      case 401:
        message.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•')
        // è·³è½¬åˆ°ç™»å½•é¡µ
        break
      case 403:
        message.error('æƒé™ä¸è¶³')
        break
      case 500:
        message.error('æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•')
        break
      default:
        message.error('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•')
    }
  } else {
    message.error('æœªçŸ¥é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜')
  }
}

// å…¨å±€é”™è¯¯å¤„ç†
export const setupGlobalErrorHandler = () => {
  window.addEventListener('unhandledrejection', (event) => {
    errorHandler(event.reason)
    event.preventDefault()
  })

  window.addEventListener('error', (event) => {
    errorHandler(event.error)
  })
}
```

### 3. æ•°æ®éªŒè¯

```typescript
// lib/validations.ts
export const commonValidations = {
  required: (message?: string) => ({
    required: true,
    message: message || 'æ­¤å­—æ®µä¸ºå¿…å¡«é¡¹'
  }),

  email: (message?: string) => ({
    type: 'email' as const,
    message: message || 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€'
  }),

  phone: (message?: string) => ({
    pattern: /^1[3-9]\d{9}$/,
    message: message || 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·ç '
  }),

  minLength: (min: number, message?: string) => ({
    min,
    message: message || `æœ€å°‘è¾“å…¥${min}ä¸ªå­—ç¬¦`
  }),

  maxLength: (max: number, message?: string) => ({
    max,
    message: message || `æœ€å¤šè¾“å…¥${max}ä¸ªå­—ç¬¦`
  })
}

// ä½¿ç”¨ç¤ºä¾‹
const userFormFields: FormField[] = [
  {
    name: 'name',
    label: 'å§“å',
    type: 'input',
    rules: [
      commonValidations.required(),
      commonValidations.minLength(2)
    ]
  },
  {
    name: 'email',
    label: 'é‚®ç®±',
    type: 'input',
    rules: [
      commonValidations.required(),
      commonValidations.email()
    ]
  }
]
```

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–

### 1. ç»„ä»¶æ‡’åŠ è½½

```typescript
// è·¯ç”±çº§åˆ«æ‡’åŠ è½½
const UserManagement = lazy(() => import('./pages/UserManagement'))
const ProductManagement = lazy(() => import('./pages/ProductManagement'))

const AppRouter = () => {
  return (
    <Suspense fallback={<Loading />}>
      <Routes>
        <Route path="/users" element={<UserManagement />} />
        <Route path="/products" element={<ProductManagement />} />
      </Routes>
    </Suspense>
  )
}

// ç»„ä»¶çº§åˆ«æ‡’åŠ è½½
const DataTable = lazy(() => import('./components/DataTable'))

const ListPage = () => {
  return (
    <Suspense fallback={<Skeleton />}>
      <DataTable columns={columns} data={data} />
    </Suspense>
  )
}
```

### 2. è™šæ‹Ÿæ»šåŠ¨

```typescript
// å¤§æ•°æ®é‡è¡¨æ ¼ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
import { FixedSizeList as List } from 'react-window'

const VirtualTable = ({ data, columns, height = 400 }) => {
  const Row = ({ index, style }) => (
    <div style={style} className="table-row">
      {columns.map(col => (
        <div key={col.key} className="table-cell">
          {data[index][col.dataIndex]}
        </div>
      ))}
    </div>
  )

  return (
    <List
      height={height}
      itemCount={data.length}
      itemSize={50}
      width="100%"
    >
      {Row}
    </List>
  )
}
```

### 3. ç¼“å­˜ç­–ç•¥

```typescript
// React Query ç¼“å­˜é…ç½®
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿå†…ä¸é‡æ–°è·å–
      cacheTime: 10 * 60 * 1000, // ç¼“å­˜10åˆ†é’Ÿ
      retry: (failureCount, error) => {
        // 4xxé”™è¯¯ä¸é‡è¯•
        if (error instanceof ApiError && error.statusCode < 500) {
          return false
        }
        return failureCount < 3
      },
      refetchOnWindowFocus: false,
    },
  },
})

// é¢„å–æ•°æ®
const prefetchUserDetails = (userId: string) => {
  queryClient.prefetchQuery({
    queryKey: ['user', userId],
    queryFn: () => fetchUser(userId),
  })
}
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

```typescript
// __tests__/components/DataTable.test.tsx
import { render, screen, fireEvent } from '@testing-library/react'
import { DataTable } from '../components/DataTable'

const mockData = [
  { id: '1', name: 'å¼ ä¸‰', email: 'zhangsan@example.com' }
]

const mockColumns = [
  { title: 'å§“å', dataIndex: 'name', key: 'name' },
  { title: 'é‚®ç®±', dataIndex: 'email', key: 'email' }
]

describe('DataTable', () => {
  it('åº”è¯¥æ¸²æŸ“æ•°æ®', () => {
    render(
      <DataTable 
        columns={mockColumns} 
        data={mockData} 
      />
    )
    
    expect(screen.getByText('å¼ ä¸‰')).toBeInTheDocument()
    expect(screen.getByText('zhangsan@example.com')).toBeInTheDocument()
  })

  it('åº”è¯¥å¤„ç†æœç´¢', () => {
    const onSearch = jest.fn()
    
    render(
      <DataTable 
        columns={mockColumns} 
        data={mockData}
        onSearch={onSearch}
      />
    )
    
    const searchInput = screen.getByPlaceholderText('æœç´¢...')
    fireEvent.change(searchInput, { target: { value: 'å¼ ä¸‰' } })
    fireEvent.click(screen.getByText('æœç´¢'))
    
    expect(onSearch).toHaveBeenCalledWith('å¼ ä¸‰')
  })
})
```

### 2. é›†æˆæµ‹è¯•

```typescript
// __tests__/pages/UserManagement.test.tsx
import { render, screen, waitFor } from '@testing-library/react'
import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
import { UserManagement } from '../pages/UserManagement'

const createTestQueryClient = () =>
  new QueryClient({
    defaultOptions: {
      queries: { retry: false },
      mutations: { retry: false },
    },
  })

const renderWithProviders = (component: React.ReactElement) => {
  const queryClient = createTestQueryClient()
  return render(
    <QueryClientProvider client={queryClient}>
      {component}
    </QueryClientProvider>
  )
}

describe('UserManagement', () => {
  it('åº”è¯¥åŠ è½½å¹¶æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨', async () => {
    renderWithProviders(<UserManagement />)
    
    expect(screen.getByText('åŠ è½½ä¸­...')).toBeInTheDocument()
    
    await waitFor(() => {
      expect(screen.getByText('ç”¨æˆ·ç®¡ç†')).toBeInTheDocument()
      expect(screen.getByText('å¼ ä¸‰')).toBeInTheDocument()
    })
  })
})
```

### 3. E2Eæµ‹è¯•

```typescript
// e2e/user-management.spec.ts
import { test, expect } from '@playwright/test'

test.describe('ç”¨æˆ·ç®¡ç†', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/login')
    await page.fill('[data-testid=email]', 'admin@example.com')
    await page.fill('[data-testid=password]', 'password123')
    await page.click('[data-testid=login-button]')
    await page.goto('/users')
  })

  test('åº”è¯¥èƒ½å¤Ÿåˆ›å»ºæ–°ç”¨æˆ·', async ({ page }) => {
    await page.click('[data-testid=create-user-button]')
    
    await page.fill('[data-testid=user-name]', 'æµ‹è¯•ç”¨æˆ·')
    await page.fill('[data-testid=user-email]', 'test@example.com')
    await page.selectOption('[data-testid=user-role]', 'user')
    
    await page.click('[data-testid=submit-button]')
    
    await expect(page.locator('.ant-message-success')).toBeVisible()
    await expect(page.locator('text=æµ‹è¯•ç”¨æˆ·')).toBeVisible()
  })
})
```

## ğŸ“± å“åº”å¼è®¾è®¡

### 1. æ–­ç‚¹ç®¡ç†

```typescript
// hooks/useBreakpoint.ts
export const useBreakpoint = () => {
  const [breakpoint, setBreakpoint] = useState<string>('lg')

  useEffect(() => {
    const updateBreakpoint = () => {
      const width = window.innerWidth
      if (width < 480) setBreakpoint('xs')
      else if (width < 576) setBreakpoint('sm')
      else if (width < 768) setBreakpoint('md')
      else if (width < 992) setBreakpoint('lg')
      else if (width < 1200) setBreakpoint('xl')
      else setBreakpoint('xxl')
    }

    updateBreakpoint()
    window.addEventListener('resize', updateBreakpoint)
    return () => window.removeEventListener('resize', updateBreakpoint)
  }, [])

  const isMobile = breakpoint === 'xs' || breakpoint === 'sm'
  const isTablet = breakpoint === 'md'
  const isDesktop = breakpoint === 'lg' || breakpoint === 'xl' || breakpoint === 'xxl'

  return { breakpoint, isMobile, isTablet, isDesktop }
}
```

### 2. å“åº”å¼å¸ƒå±€

```typescript
// components/ResponsiveLayout.tsx
const ResponsiveLayout = ({ children }) => {
  const { isMobile, isTablet } = useBreakpoint()

  return (
    <Layout className={cn(
      'min-h-screen',
      isMobile && 'mobile-layout',
      isTablet && 'tablet-layout'
    )}>
      <Sider 
        collapsible
        collapsed={isMobile}
        trigger={null}
        width={isMobile ? 0 : 256}
        collapsedWidth={isMobile ? 0 : 80}
      >
        <SideMenu />
      </Sider>
      
      <Layout>
        <Header className="flex items-center justify-between">
          {isMobile && <MobileMenuButton />}
          <div className="flex-1" />
          <UserDropdown />
        </Header>
        
        <Content className={cn(
          'p-6',
          isMobile && 'p-4'
        )}>
          {children}
        </Content>
      </Layout>
    </Layout>
  )
}
```

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

### 1. è¾“å…¥éªŒè¯

```typescript
// lib/sanitize.ts
import DOMPurify from 'dompurify'

export const sanitizeInput = (input: string): string => {
  return DOMPurify.sanitize(input.trim())
}

export const validateInput = (input: string, rules: ValidationRule[]): string[] => {
  const errors: string[] = []
  
  for (const rule of rules) {
    if (!rule.validator(input)) {
      errors.push(rule.message)
    }
  }
  
  return errors
}

// ä½¿ç”¨ç¤ºä¾‹
const handleSubmit = (data: FormData) => {
  const sanitizedData = {
    name: sanitizeInput(data.name),
    description: sanitizeInput(data.description)
  }
  
  // æäº¤å¤„ç†
}
```

### 2. XSSé˜²æŠ¤

```typescript
// components/SafeHTML.tsx
interface SafeHTMLProps {
  html: string
  className?: string
}

export const SafeHTML: React.FC<SafeHTMLProps> = ({ html, className }) => {
  const sanitizedHTML = useMemo(() => {
    return DOMPurify.sanitize(html, {
      ALLOWED_TAGS: ['p', 'br', 'strong', 'em', 'u', 'a'],
      ALLOWED_ATTR: ['href', 'target'],
    })
  }, [html])

  return (
    <div 
      className={className}
      dangerouslySetInnerHTML={{ __html: sanitizedHTML }}
    />
  )
}
```

### 3. CSRFé˜²æŠ¤

```typescript
// lib/csrf.ts
export const getCSRFToken = (): string => {
  const meta = document.querySelector('meta[name="csrf-token"]')
  return meta?.getAttribute('content') || ''
}

export const apiClientWithCSRF = axios.create({
  baseURL: '/api',
  headers: {
    'X-CSRF-Token': getCSRFToken(),
  },
})
```

## ğŸ“ˆ ç›‘æ§å’Œåˆ†æ

### 1. é”™è¯¯ç›‘æ§

```typescript
// lib/monitoring.ts
import * as Sentry from '@sentry/nextjs'

export const initMonitoring = () => {
  Sentry.init({
    dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
    environment: process.env.NODE_ENV,
    tracesSampleRate: 1.0,
  })
}

export const trackError = (error: Error, context?: Record<string, any>) => {
  Sentry.captureException(error, {
    contexts: { custom: context },
  })
}

export const trackEvent = (eventName: string, properties?: Record<string, any>) => {
  Sentry.addBreadcrumb({
    message: eventName,
    data: properties,
    level: 'info',
  })
}
```

### 2. æ€§èƒ½ç›‘æ§

```typescript
// lib/performance.ts
export const measurePerformance = (name: string, fn: () => void) => {
  const start = performance.now()
  fn()
  const end = performance.now()
  
  console.log(`${name} æ‰§è¡Œæ—¶é—´: ${end - start}ms`)
  
  // ä¸ŠæŠ¥æ€§èƒ½æ•°æ®
  if (end - start > 1000) {
    trackEvent('slow_operation', {
      operation: name,
      duration: end - start,
    })
  }
}

export const usePerformanceMonitor = (componentName: string) => {
  useEffect(() => {
    const startTime = performance.now()
    
    return () => {
      const endTime = performance.now()
      const renderTime = endTime - startTime
      
      if (renderTime > 500) {
        trackEvent('slow_render', {
          component: componentName,
          renderTime,
        })
      }
    }
  }, [componentName])
}
```

## ğŸ“š æ–‡æ¡£åŒ–

### 1. ä»£ç æ³¨é‡Š

```typescript
/**
 * æ•°æ®è¡¨æ ¼ç»„ä»¶
 * 
 * @example
 * ```tsx
 * <DataTable
 *   columns={columns}
 *   data={data}
 *   loading={loading}
 *   onRefresh={() => refetch()}
 * />
 * ```
 */
export interface DataTableProps<T = any> {
  /** è¡¨æ ¼åˆ—é…ç½® */
  columns: DataTableColumn<T>[]
  /** è¡¨æ ¼æ•°æ® */
  data: T[]
  /** åŠ è½½çŠ¶æ€ */
  loading?: boolean
  /** åˆ·æ–°å›è°ƒ */
  onRefresh?: () => void
}
```

### 2. READMEæ–‡æ¡£

```markdown
# ç”¨æˆ·ç®¡ç†æ¨¡å—

## åŠŸèƒ½è¯´æ˜

ç”¨æˆ·ç®¡ç†æ¨¡å—æä¾›å®Œæ•´çš„ç”¨æˆ·CRUDæ“ä½œï¼ŒåŒ…æ‹¬ï¼š

- ç”¨æˆ·åˆ—è¡¨æŸ¥çœ‹
- ç”¨æˆ·åˆ›å»ºå’Œç¼–è¾‘
- ç”¨æˆ·æƒé™ç®¡ç†
- ç”¨æˆ·çŠ¶æ€æ§åˆ¶

## ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ç”¨æ³•

```tsx
import { UserManagement } from '@/components/business'

export default function UsersPage() {
  return <UserManagement />
}
```

### è‡ªå®šä¹‰é…ç½®

```tsx
<UserManagement
  searchable={true}
  exportable={true}
  batchOperations={true}
/>
```

## APIæ¥å£

- `GET /api/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `POST /api/users` - åˆ›å»ºç”¨æˆ·
- `PUT /api/users/:id` - æ›´æ–°ç”¨æˆ·
- `DELETE /api/users/:id` - åˆ é™¤ç”¨æˆ·

## æƒé™è¦æ±‚

- `users:view` - æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
- `users:create` - åˆ›å»ºç”¨æˆ·
- `users:edit` - ç¼–è¾‘ç”¨æˆ·
- `users:delete` - åˆ é™¤ç”¨æˆ·
```

è¿™äº›æœ€ä½³å®è·µå°†å¸®åŠ©ä½ æ„å»ºé«˜è´¨é‡ã€å¯ç»´æŠ¤ã€å®‰å…¨çš„åå°ç®¡ç†ç³»ç»Ÿã€‚è®°ä½ï¼Œå¥½çš„ä»£ç ä¸ä»…ä»…æ˜¯èƒ½è¿è¡Œï¼Œæ›´é‡è¦çš„æ˜¯æ˜“äºç†è§£ã€æµ‹è¯•å’Œç»´æŠ¤ã€‚